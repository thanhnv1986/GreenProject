{% extends '../layout-admin.server.view.html' %}
{% block content %}
  <div class="portlet">
    <div class="portlet-title">
      <div class="caption">
        {% include '../toolbar-admin.server.view.html' %}
      </div>
    </div>
    <div class="portlet-body">
      <table class="table table-striped table-bordered" id="sample_editable_1">
        <thead>
        <tr>
          <th></th>
          <th>Tên công việc</th>
          <th>Ngày hết hạn</th>
          <th>Link</th>
        </tr>
        </thead>
        <tbody>
        {% for job in jobs %}
          <tr class="record">
            <td><input class="bId" name="id[]" type="checkbox" value="{{ job.id }}"></td>
            <td>
              <a href="/admin/jobs/{{ job.id }}">{{ job.title }}</a>


            </td>
            <td>{{ job.expires_dates }}</td>
            <td>{{ job.job_link }}</td>

          </tr>
        {% endfor %}
        </tbody>
      </table>
      {{ totalPage|pagination(currentPage,'/admin/jobs/page/{page}')|safe }}
    </div>
  </div>
  <div class="modal fade" id="confirm" tabindex="-1" role="basic" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
          <h4 class="modal-title">Xóa việc làm</h4>
        </div>
        <div class="modal-body">
          Bạn chắc chắn muốn xóa?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn default" data-dismiss="modal">Hủy</button>
          <button type="button" class="btn btn-danger" onclick="return deletejobs()">Xóa</button>
        </div>
      </div>
      <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
  </div>
{% endblock %}

{% block jsExtends %}
  {% include '../editorScript.html' %}
{% endblock %}

{% block jsFooter %}
  <script>
    function deletejobs() {
      var ids = [];
      $("input:checkbox[name='id[]']:checked").each(function () {
        ids.push($(this).val());
      });
      $.ajax({
        url: '/admin/jobs/?ids=' + ids.join(),
        type: 'DELETE',
        success: function () {
          window.location.href="/admin/jobs/page/{{ currentPage }}";
        }
      });
    }
    $(document).ready(function () {
      $('.delConfirm').confirmation({
        onConfirm: function (e) {
          var prevTd = $(e.target).parent().parent().parent().parent().prev('td');
          var id = $(prevTd).find('div').find('span').find('input').val();
          $.ajax({
            url: '/admin/jobd/?ids=' + id,
            type: 'DELETE',
            success: function () {
              location.reload();
            }
          });
        }
      });
    });
  </script>
{% endblock %}
